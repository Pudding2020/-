# 双智能小车

- 以STC89C51单片机为控制系统的核心，包含电机驱动模块、循迹模块、电源模块、测距模块、无线收发模块等，能实现：

  甲乙两车对赛道上的黑线进行识别，控制小车行走与转弯；

  对颜色传感器检测信号进行采样，同时用1602显示采集到的颜色变化，实现小车能自行通过红绿灯；

  利用无线通信使两车进入赛道有先有后，不会撞车；

  超声波测距+PID算法，小车自动调整车距，保持车距在20cm左右。

- 电机驱动模块：

  L289N产生的PWM波进行驱动，利用单片机控制，使之工作在占空比可调的开关状态，能精确控制电机转速。

- NRF24L01

  1.收发过程

  发射数据时，首先将nRF24L01配置为发射模式，接着把接收节点地址TX_ADDR和有效数据TX_PLD按照时序由SPI口写入nRF24L01缓存区，TX_PLD必须在CSN为低时连续写入，而TX_ADDR在发射时写入一次即可，然后
  
  CE置为高电平并保持至少10μs，延迟130μs后发射数据；

  若自动应答开启，那么nRF24L01在发射数据后立即进入接收模式，接收应答信号（自动应答接收地址应该与接收节点地址TX_ADDR一致）。

  如果收到应答，则认为此次通信成功，TX_DS置高，同时TX_PLD从TX FIFO中清除；若未收到应答，则自动重新发射该数据(自动重发已开启)，若重发次数(ARC)达到上限，MAX_RT置高，TX FIFO中数据保留以便再次重发；MAX_RT或TX_DS置高时，使IRQ变低，产生中断，通知MCU。

  最后发射成功时,若CE为低则nRF24L01进入空闲模式1；若发送堆栈中有数据且CE为高，则进入下一次发射；若发送堆栈中无数据且CE为高，则进入空闲模式2。

  接收数据时，首先将nRF24L01配置为接收模式，接着延迟130μs进入接收状态等待数据的到来。当接收方检测到有效的地址和CRC时，就将数据包存储在RX FIFO中，同时中断标志位RX_DR置高，IRQ变低，产生中断，通知MCU去取数据。若此时自动应答开启，接收方则同时进入发射状态回传应答信号。最后接收成功时，若CE变低，则nRF24L01进入空闲模式1。
  
  2.SPI口为同步串行通信接口，最大传输速率为10 Mb/s，传输时先传送低位字节，再传送高位字节。但针对单个字节而言，要先送高位再送低位。
  
  3.nRF24L0l所有的配置字都由配置寄存器定义，这些配置寄存器可通过SPI口访问，nRF24L01的配置寄存器共有25个。
